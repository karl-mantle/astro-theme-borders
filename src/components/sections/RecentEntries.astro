---
import type { DataEntryMap } from 'astro:content';
import type { SectionProps } from '../../types';
import { PERMALINK_POSTS_SINGLE, PERMALINK_CUSTOM_SINGLE, PERMALINK_POSTS, PERMALINK_CUSTOM } from '../../consts';
import { getEntries } from '../../utils';
import Container from './Container.astro';
import PostCard from '../cards/Post.astro';
import CustomCard from '../cards/Post.astro';

interface Props extends SectionProps {
  columns: number,
  contentCollection: keyof DataEntryMap,
  maxEntries?: number
};

const { title, titleTag = 'h2', description, primaryButtonProps, secondaryButtonProps, columns, contentCollection, maxEntries = 3, class: className, ...rest }: Partial<Props> = Astro.props;

const entries = await getEntries(contentCollection, maxEntries);

let defaultTitle;
switch (contentCollection) {
  case 'posts':
    defaultTitle = 'Recent posts'
    break;
  case 'custom':
    defaultTitle = 'Recent custom'
    break;
  default:
    defaultTitle = 'Lorem ipsum dolor sit amet'
    break;
};

let defaultHref;
switch (contentCollection) {
  case 'posts':
    defaultHref = `${Astro.site}${PERMALINK_POSTS}`;
    break;
  case 'custom':
    defaultHref = `${Astro.site}${PERMALINK_CUSTOM}`;
    break;
  default:
    defaultHref = '404';
    break;
};
---

<Container
  columns={columns}
  title={title || defaultTitle }
  titleTag={titleTag}
  description={description}
  primaryButtonProps={primaryButtonProps || { buttonStyle: 'link', href: `${defaultHref}`, text: 'View all posts', textClass: '', icon: 'tabler:arrow-right', iconSize: 21, iconReverse: false, iconRotate: true }}
  secondaryButtonProps={secondaryButtonProps}
  class={className}
  {...rest}
>

  { contentCollection === 'posts' && (
    entries.map((post) =>
      <PostCard
        title={post.data.title}
        titleTag="h3"
        description={post.data.description}
        date={post.data.pubDate}
        image={post.data.image?.src}
        alt={post.data.image?.alt}
        href={`/${PERMALINK_POSTS_SINGLE}/${post.data.slug}/`}
      />
    )
  )}

  { contentCollection === 'custom' && (
    entries.map((custom) =>
      <CustomCard
        title={custom.data.title}
        titleTag="h3"
        description={custom.data.description}
        image={custom.data.image?.src}
        alt={custom.data.image?.alt}
        href={`/${PERMALINK_CUSTOM_SINGLE}/${custom.data.slug}/`}
      />
    )
  )}

</Container>
